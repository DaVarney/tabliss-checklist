<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily Routine Checklist</title>
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    margin: 0;
    padding: 12px;
    background: transparent;
    color: #f0f0f0;
  }

  .section {
    margin-bottom: 16px;
    background: rgba(0,0,0,0.35);
    padding: 10px 12px;
    border-radius: 8px;
  }

  h2 {
    margin: 0 0 8px;
    font-size: 18px;
    font-weight: 600;
  }

  label {
    display: flex;
    align-items: center;
    margin: 4px 0;
    cursor: pointer;
  }

  input[type="checkbox"] {
    transform: scale(1.2);
    margin-right: 8px;
  }

  .weekly-dots {
    margin-left: 4px;
    font-size: 12px;
    opacity: 0.75;
  }

  .dot-filled {
    color: #6eff6e;
    font-weight: bold;
  }
</style>
</head>
<body>

<div id="app"></div>

<script>
(function() {
  const today = new Date();
  const weekdayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  const todayName = weekdayNames[today.getDay()];
  const todayKey = today.toISOString().slice(0,10); // YYYY-MM-DD
  const weekKey = `${today.getFullYear()}-W${getISOWeek(today)}`;
  const storageKey = "daily-checklist-state-v1";

  // TASK DEFINITIONS
  const TASKS = [
    { id: "teeth-am", label: "Brush teeth – AM", group: "AM", days: null },
    { id: "feed-am",  label: "Feed pets – AM",   group: "AM", days: null },

    { id: "teeth-pm", label: "Brush teeth – PM", group: "PM", days: null },
    { id: "feed-pm",  label: "Feed pets – PM",   group: "PM", days: null },

    { id: "litter",   label: "Scoop litter box", group: "Household", days: ["Wed","Sun"] },
    { id: "vacuum",   label: "Vacuum",           group: "Household", days: ["Wed","Fri","Sun"] }
  ];

  // LOAD OR RESET STATE
  let state = {};
  try {
    state = JSON.parse(localStorage.getItem(storageKey)) || {};
  } catch {
    state = {};
  }

  // New day? Reset daily completed state
  if (state.date !== todayKey) {
    state.date = todayKey;
    state.completed = {};
  }

  if (!state.weekly) state.weekly = {};

  // RENDER APP
  const app = document.getElementById("app");
  app.innerHTML = "";

  const groups = ["AM", "PM", "Household"];
  groups.forEach(group => {
    const section = document.createElement("div");
    section.className = "section";
    section.innerHTML = `<h2>${group}</h2>`;
    const eligibleTasks = TASKS.filter(t => t.group === group && showToday(t));
    
    if (eligibleTasks.length === 0) return;

    eligibleTasks.forEach(task => {
      const row = document.createElement("label");

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = !!state.completed[task.id];

      cb.addEventListener("change", () => {
        state.completed[task.id] = cb.checked;
        updateWeekly(task.id, cb.checked);
        saveState();
        render(); // Refresh dots
      });

      const text = document.createElement("span");
      text.textContent = task.label;

      const dots = document.createElement("span");
      dots.className = "weekly-dots";
      dots.innerHTML = renderDots(task.id);

      row.appendChild(cb);
      row.appendChild(text);
      row.appendChild(dots);

      section.appendChild(row);
    });

    app.appendChild(section);
  });

  function saveState() {
    localStorage.setItem(storageKey, JSON.stringify(state));
  }

  function showToday(task) {
    if (!task.days) return true; 
    return task.days.includes(todayName);
  }

  function updateWeekly(taskId, checked) {
    if (!state.weekly[weekKey]) state.weekly[weekKey] = {};
    if (!state.weekly[weekKey][taskId]) state.weekly[weekKey][taskId] = [];

    if (checked && !state.weekly[weekKey][taskId].includes(todayName)) {
      state.weekly[weekKey][taskId].push(todayName);
    }
  }

  function renderDots(taskId) {
    const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
    const done = (state.weekly[weekKey] && state.weekly[weekKey][taskId]) || [];

    return days.map(d => 
      done.includes(d) 
        ? `<span class="dot-filled">•</span>` 
        : `<span>•</span>`
    ).join(" ");
  }

  // ISO WEEK FUNCTION
  function getISOWeek(date) {
    const tmp = new Date(date.valueOf());
    const day = (date.getDay() + 6) % 7;
    tmp.setDate(tmp.getDate() - day + 3);
    const firstThursday = tmp.valueOf();
    tmp.setMonth(0,1);
    const firstDay = tmp.getDay();
    tmp.setDate(tmp.getDate() + ((firstDay <= 4 ? 4-firstDay : 11-firstDay)));
    return 1 + Math.ceil((firstThursday - tmp) / 604800000);
  }

  function render() {
    document.querySelectorAll(".weekly-dots").forEach(el => el.remove());
    app.innerHTML = "";
    groups.forEach(group => {
      const section = document.createElement("div");
      section.className = "section";
      section.innerHTML = `<h2>${group}</h2>`;
      const eligibleTasks = TASKS.filter(t => t.group === group && showToday(t));

      if (eligibleTasks.length === 0) return;

      eligibleTasks.forEach(task => {
        const row = document.createElement("label");

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!state.completed[task.id];
        cb.addEventListener("change", () => {
          state.completed[task.id] = cb.checked;
          updateWeekly(task.id, cb.checked);
          saveState();
          render();
        });

        const text = document.createElement("span");
        text.textContent = task.label;

        const dots = document.createElement("span");
        dots.className = "weekly-dots";
        dots.innerHTML = renderDots(task.id);

        row.appendChild(cb);
        row.appendChild(text);
        row.appendChild(dots);
        section.appendChild(row);
      });

      app.appendChild(section);
    });
  }
})();
</script>

</body>
</html>
